#
# This patch addresses CVE-2018-20685:
#   scp.c in the scp client allows remote SSH servers to bypass intended
#   access restrictions via the filename of . or an empty filename. The impact
#   is modifying the permissions of the target directory on the client side.
#
# and was taken from this changeset:
#   https://github.com/openssh/openssh-portable/commit/6010c0303a422a9c5fa8860c061bf7105eb7f8b2
#
# This patch should be obsoleted by the next OpenSSH update after 7.9.
#
--- openssh-7.7p1/scp.c	2019-01-31 12:38:52.510078181 +0000
+++ openssh-7.7p1/scp.c	2019-01-31 12:41:06.760890902 +0000
@@ -1104,7 +1104,8 @@ sink(int argc, char **argv)
 			SCREWUP("size out of range");
 		size = (off_t)ull;
 
-		if ((strchr(cp, '/') != NULL) || (strcmp(cp, "..") == 0)) {
+		if (*cp == '\0' || strchr(cp, '/') != NULL ||
+		    strcmp(cp, ".") == 0 || strcmp(cp, "..") == 0) {
 			run_err("error: unexpected filename: %s", cp);
 			exit(1);
 		}
