For some reason when ruby test is run, it doesn't always use ruby executable in the proto area but already installed ruby (which is several versions lower). This can result in errors which are not a problem for new version.
I was not able to solve this problem by neighter setting PATH to proto area first or setting RUBY makefile variables to new version.

Because of that Ruby should be tested on machine where given version is already installed (e.g. virtual build machines).

How to work with virtual machines:
https://dorfl.cz.oracle.com/twiki/bin/view/Dorfl/Virtualbox

Ruby bug with this issue:
https://bugs.ruby-lang.org/issues/15227
