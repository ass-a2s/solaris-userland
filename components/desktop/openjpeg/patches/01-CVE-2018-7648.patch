CVE-2018-7648 : issue with mj2/opj_mj2_extract.c in openjpeg

opj_mj2_extract: Check provided output prefix for length

This uses snprintf() with correct buffer length instead of sprintf(). This
prevents a buffer overflow when providing a long output prefix. Furthermore
the program exits with an error when the provided output prefix is too long.

Fixes #1088.

kbabioch committed on Mar 2
1 parent 564fbfb commit 6d8c0c06ee32dc03ba80acd48334e98728e56cf5

--- a/src/bin/mj2/opj_mj2_extract.c	2018-05-15 22:12:15.188161034 -0700
+++ b/src/bin/mj2/opj_mj2_extract.c	2018-05-15 22:13:13.970452997 -0700
@@ -140,7 +140,12 @@
         fread(frame_codestream, sample->sample_size - 8, 1,
               file); /* Assuming that jp and ftyp markers size do*/
 
-        sprintf(outfilename, "%s_%05d.j2k", argv[2], snum);
+        int num = snprintf(outfilename, sizeof(outfilename), "%s_%05d.j2k", argv[2], snum);
+        if (num >= sizeof(outfilename)) {
+            fprintf(stderr, "maximum length of output prefix exceeded\n");
+            return 1;
+        }
+
         outfile = fopen(outfilename, "wb");
         if (!outfile) {
             fprintf(stderr, "failed to open %s for writing\n", outfilename);
