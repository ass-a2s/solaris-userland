From e54e1299404101a5a9d0cf5e45512b543967f958 Mon Sep 17 00:00:00 2001
From: Mark Adler <madler@alumni.caltech.edu>
Date: Sat, 5 Sep 2015 17:45:55 -0700
Subject: [PATCH] Avoid shifts of negative values inflateMark().

The C standard says that bit shifts of negative integers is
undefined.  This casts to unsigned values to assure a known
result.

Note, that this patch was re-generate to avoid Hunk.

--- rsync-3.1.3/zlib/inflate.c.orig     2013-06-09 22:27:33.000000000 -0700
+++ rsync-3.1.3/zlib/inflate.c  2018-09-14 06:36:45.772828042 -0700
@@ -1525,9 +1525,10 @@
 {
     struct inflate_state FAR *state;
 
-    if (strm == Z_NULL || strm->state == Z_NULL) return -1L << 16;
+    if (strm == Z_NULL || strm->state == Z_NULL)
+        return (long)(((unsigned long)0 - 1) << 16);
     state = (struct inflate_state FAR *)strm->state;
-    return ((long)(state->back) << 16) +
+    return (long)(((unsigned long)((long)state->back)) << 16) +
         (state->mode == COPY ? state->length :
             (state->mode == MATCH ? state->was - state->length : 0));
 }

From 2edb94a3025d288dc251bc6cbb2c02e60fbd7438 Mon Sep 17 00:00:00 2001
From: Mark Adler <madler@alumni.caltech.edu>
Date: Tue, 11 Oct 2016 18:38:20 -0700
Subject: [PATCH] Avoid casting an out-of-range value to long.

---
 inflate.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/zlib/inflate.c b/zlib/inflate.c
index 9ee84d07..2f3fcc9a 100644
--- a/zlib/inflate.c
+++ b/zlib/inflate.c
@@ -1526,7 +1526,7 @@ z_streamp strm;
     struct inflate_state FAR *state;
 
     if (strm == Z_NULL || strm->state == Z_NULL)
-        return (long)(((unsigned long)0 - 1) << 16);
+        return -(1L << 16);
     state = (struct inflate_state FAR *)strm->state;
     return (long)(((unsigned long)((long)state->back)) << 16) +
         (state->mode == COPY ? state->length :
